!function(a){"use strict";function b(b){if(this.options={selector:"*",mouseEvents:["click","dblclick","mousedown","mouseup"],usePolyfillIf:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent;if(null!=a.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/)){var b=parseFloat(RegExp.$1);if(11>b)return!0}}return!1}},b){var c=this;a.each(b,function(a,b){c.options[a]=b})}this.options.usePolyfillIf()&&this.register_mouse_events()}function c(a,b){this.container=null,this.config=null,this.controls={},this.hotSpots=[],this.popover=!1,this.popoverTemplate=null,this.popoverCloseManual=!1,this.popoverClosePopover=!1,this.imgWidth=0,this.imgHeight=0,this.zindex=4,this.hotSpotSetup=!1,this.id=f++,this.ready=!1,this.init(a,b)}b.initialize=function(a){return null==b.singleton&&(b.singleton=new b(a)),b.singleton},b.prototype.register_mouse_events=function(){a(document).on(this.options.mouseEvents.join(" "),this.options.selector,function(b){if("none"==a(this).css("pointer-events")){var c=a(this).css("display");a(this).css("display","none");var d=document.elementFromPoint(b.clientX,b.clientY);return c?a(this).css("display",c):a(this).css("display",""),b.target=d,a(d).trigger(b),!1}return!0})},b.initialize({selector:".imgl-popover"});var d=function(){function a(){}return a.prototype.css2json=function(a){var b={};if(!a)return b;if(a instanceof CSSStyleDeclaration)for(var c in a)a[c].toLowerCase&&(b[a[c].toLowerCase()]=a[a[c]]);else if("string"==typeof a){a=a.split(";");for(var c in a){var d=a[c].split(":");2==d.length&&(b[d[0].toLowerCase().trim()]=d[1].trim())}}return b},a.prototype.isMobile=function(a){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a)},a.prototype.animationEvent=function(){var a=document.createElement("fakeelement"),b={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var c in b)if(void 0!==a.style[c])return b[c]},a}(),e="imglnks",f=0;c.prototype={VERSION:"1.4.3",defaults:{theme:"imgl-default",popover:!0,popoverTemplate:"<div class='imgl-popover'><div class='imgl-close'></div><div class='imgl-arrow'></div><div class='imgl-content'></div></div>",popoverPlacement:"top",popoverShowTrigger:"hover",popoverHideTrigger:"leave",popoverShowClass:null,popoverHideClass:null,hotSpotBelowPopover:!0,hotSpots:[],hotSpotSetup:!1,mobile:!1,onLoad:null},init:function(a,b){this.container=a,this.config=b,this.checkAnimation(),this.destroy(),this.applyImage()},create:function(){this.applyDOM(),this.applyHandlers(),this.applyPopoverSupport(),this.applyHotSpots(),this.updateHotSpots(),"function"==typeof this.config.onLoad&&this.config.onLoad.call(this),this.ready=!0},checkAnimation:function(){var a=!this.config.mobile&&this.util().isMobile(navigator.userAgent);(void 0==this.util().animationEvent()||a)&&(this.config.popoverShowClass=null,this.config.popoverHideClass=null)},applyImage:function(){if(!this.container.is("img"))return void console.error("Cannot load image, the container should be an 'img' element");this.container.get(0).onload=a.proxy(function(a){this.ready&&this.updateLayout()},this);var b=this.container.data("imgl-src")||this.container.attr("src");if(b){var c=new Image;c.onload=a.proxy(function(a){this.imgWidth=c.width,this.imgHeight=c.height,this.create()},this),c.onerror=a.proxy(function(a){console.error("Cannot load image '"+b+"'")},this),c.src=b}else console.error("Cannot load image, the parameter 'image' must be defined")},applyDOM:function(){this.container.wrap("<div class='imgl'></div>"),this.container.wrap("<div class='imgl-img'></div>"),this.controls.$img=this.container.closest(".imgl-img"),this.controls.$main=this.container.closest(".imgl"),this.controls.$img.detach().css({top:-9999,left:-9999,width:0,position:"absolute"}),this.controls.$img.appendTo("body"),setTimeout(a.proxy(function(){this.controls.$img.detach().removeAttr("style"),this.controls.$img.prependTo(this.controls.$main)},this),1),this.controls.$view=a("<div class='imgl-view'></div>"),this.controls.$view.addClass(this.config.theme).attr("id",this.getUID("imgl")),this.config.hotSpotSetup&&this.controls.$view.addClass("imgl-hotspot-setup").attr("tabindex",1),this.controls.$hotspots=a("<div class='imgl-hotspots'></div>"),this.controls.$view.append(this.controls.$hotspots),this.controls.$main.append(this.controls.$view)},resetDOM:function(){this.controls.$view.remove(),this.container.unwrap(".imgl-img"),this.container.unwrap(".imgl")},applyHandlers:function(){this.config.hotSpotSetup&&(this.controls.$view.on("click.imgl",a.proxy(this.onViewClick,this)),this.controls.$view.on("keydown.imgl",a.proxy(this.onViewKeyDown,this)),this.controls.$view.on("keyup.imgl",a.proxy(this.onViewKeyUp,this))),this.controls.$img.on("animationstart.imgl MSAnimationStart.imgl webkitAnimationStart.imgl",a.proxy(this.onAnimationStart,this)),a(window).on("load.imgl-"+this.id,a.proxy(this.onLoad,this)),a(window).on("resize.imgl-"+this.id,a.proxy(this.onResize,this))},resetHandlers:function(){this.controls.$view.off("click.imgl"),this.controls.$view.off("keydown.imgl"),this.controls.$view.off("keyup.imgl"),a(window).off("load.imgl-"+this.id),a(window).off("resize.imgl-"+this.id)},applyHotSpots:function(){for(var b=JSON.parse(JSON.stringify(this.config.hotSpots)),c=0,d=b.length;d>c;c++){var e=b[c];if(e.className?e.$el=a("<div class='imgl-hotspot-custom "+e.className+"'></div>"):e.imageUrl?e.$el=a("<div class='imgl-hotspot-custom'></div>"):e.$el=a("<div class='imgl-hotspot'></div>"),e.imageUrl){var f="style='";(e.imageWidth||e.imageHeight)&&(f=f+(e.imageWidth?"width:"+e.imageWidth+"px;":"")+(e.imageHeight?"height:"+e.imageHeight+"px;":"")),f+="'";var g=a("<div class='imgl-hotspot-image'></div>");e.$image=a("<img src='"+e.imageUrl+"' alt=''"+f+">"),e.$el.append(g.append(e.$image))}if(e.link){var g=a("<div class='imgl-hotspot-link'></div>").append("<a href='"+e.link+"' target='"+(e.linkNewWindow?"_blank":"_self")+"' rel='nofollow'>");e.$el.append(g)}if(e.content){var g=a("<div class='imgl-hotspot-data'></div>").append(e.content);e.$el.append(g)}if("boolean"!=typeof e.popoverLazyload&&(e.popoverLazyload=!0),"boolean"!=typeof e.popoverShow&&(e.popoverShow=!1),e.id=this.getUID("hotspot"),e.$el.attr("id",e.id),e.$popover=null,e.visible=!0,"function"==typeof this.config.hotSpots[c].popoverContent&&(e.popoverContent=this.config.hotSpots[c].popoverContent),e.popoverContent||e.popoverSelector){for(var h=this.config.popoverShowTrigger.trim().split(" "),i=h.length;i--;){var j=h[i];"click"==j?(e.$el.on("click.imgl",a.proxy(this.onHotSpotClick,this,e)),e.$el.on("touchstart.imgl",a.proxy(this.onHotSpotClick,this,e)),e.$el.on("touchend.imgl",a.proxy(this.onHotSpotTouchEnd,this,e))):"hover"==j&&(e.$el.on("mouseenter.imgl",a.proxy(this.onHotSpotEnter,this,e)),e.$el.on("touchstart.imgl",a.proxy(this.onHotSpotClick,this,e)),e.$el.on("touchend.imgl",a.proxy(this.onHotSpotTouchEnd,this,e)))}for(var h=this.config.popoverHideTrigger.trim().split(" "),i=h.length;i--;){var j=h[i];"click"==j?(e.$el.on("click.imgl",a.proxy(this.onPopoverHide,this,e)),e.$el.on("touchstart.imgl",a.proxy(this.onPopoverHide,this,e))):"bodyclick"==j?a("body").add(this.controls.$view).on("mousedown.imgl touchstart.imgl",a.proxy(this.onPopoverHide,this,e)):"leave"==j?(e.$el.on("mouseleave.imgl",a.proxy(this.onHotSpotLeave,this,e)),a("body").add(this.controls.$view).on("touchstart.imgl",a.proxy(this.onPopoverHide,this,e))):"popover"==j?this.popoverClosePopover=!0:"manual"==j&&(this.popoverCloseManual=!0)}}this.controls.$hotspots.append(e.$el),!this.popover||e.popoverLazyload&&!e.popoverShow||this.createPopover(e)}this.hotSpots=this.hotSpots.concat(b)},resetHotSpots:function(){this.controls.$hotspots.children().fadeTo("slow",0,function(){a(this).remove()})},updateHotSpots:function(){var a=this.container.width(),b=this.container.height();0==a||0==b?this.controls.$view.css({display:"none"}):this.controls.$view.css({display:"block"});var c=(this.container.get(0).getBoundingClientRect(),0),d=0,e=parseInt(this.container.css("margin-top"),10),f=parseInt(this.container.css("margin-left"),10),g=parseInt(this.container.css("padding-top"),10),h=parseInt(this.container.css("padding-left"),10),i=parseInt(this.container.css("border-top-width"),10),j=parseInt(this.container.css("border-left-width"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),isNaN(e)&&(e=0),isNaN(f)&&(f=0),isNaN(i)&&(i=0),isNaN(j)&&(j=0),c+=e+g+i,d+=f+h+j,this.controls.$view.css({top:c,left:d,width:a,height:b});for(var k=this.hotSpots.length;k--;){var l=this.hotSpots[k],m=l.$el.width(),n=l.$el.height(),d=a*l.x,c=b*l.y,d=Math.round(d-m/2),c=Math.round(c-n/2);l.$el.css({left:d,top:c})}},applyPopoverSupport:function(){if(this.popover=this.config.popover,this.popover){var b=a(this.config.popoverTemplate);return 1!=b.length?(this.popover=!1,void console.error("'popoverTemplate' option must consist of exactly 1 top-level element!")):void(this.popoverTemplate=this.config.popoverTemplate)}},createPopover:function(b){if(!b.$popover){b.$popover=a(this.popoverTemplate);var c=this.getUID("popover");b.$popover.attr("id",c),this.popoverCloseManual&&(b.$popover.addClass("imgl-close"),b.$popover.find(".imgl-close").on("click.imgl",a.proxy(this.onPopoverHide,this,b))),b.$popover.on("click.imgl",a.proxy(this.onPopoverClick,this,b))}var d=b.$popover;if(!d.hasClass("imgl-active")||b.$popover.hasClass(this.config.popoverHideClass)){var e=this.getPopoverContent(b);d.find(".imgl-content").children().detach().end()[b.popoverHtml?"string"==typeof e?"html":"append":"text"](e),d.detach().css({top:-9999,left:-9999,width:""}),d.removeClass(this.config.popoverHideClass),d.removeClass(this.config.popoverShowClass),b.popoverWidth&&d.css({"max-width":b.popoverWidth,"min-width":b.popoverWidth}),this.liftupPopover(b),d.appendTo(this.controls.$view),d.css({width:d[0].offsetWidth})}},showPopover:function(b){if(this.popover&&b.visible&&b.popover&&(b.popoverContent||b.popoverSelector)){this.createPopover(b);var c=this.config.popoverPlacement;b.popoverPlacement&&(c=b.popoverPlacement);var d=this.getPopoverPosition(b),e=b.$popover,f=e[0].offsetWidth,g=e[0].offsetHeight,h=this.getPopoverOffset(c,d,f,g);if(this.applyPopoverPlacement(b,h,c),e.hasClass("imgl-active")||(e.removeClass(this.config.popoverHideClass),e.addClass(this.config.popoverShowClass),this.config.popoverShowClass?(e.css("visibility","visible"),e.addClass("imgl-active").addClass(this.config.popoverShowClass),e.one(this.util().animationEvent(),a.proxy(function(b){var c=a(b.target);c.hasClass(this.config.popoverHideClass)||c.removeClass(this.config.popoverShowClass),c.css("visibility","")},this))):e.addClass("imgl-active")),this.popoverClosePopover)for(var i=0,j=this.hotSpots.length;j>i;i++){var k=this.hotSpots[i];k.id!=b.id&&k.$popover&&k.$popover.hasClass("imgl-active")&&this.hidePopover(k)}}},updatePopovers:function(){for(var a=this.hotSpots.length;a--;){var b=this.hotSpots[a];b.$popover&&b.$popover.hasClass("imgl-active")&&this.showPopover(b)}},showPopovers:function(){for(var a=this.hotSpots.length;a--;){var b=this.hotSpots[a];b.popover&&b.popoverShow&&this.showPopover(b)}},getUID:function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},getPopoverContent:function(b){if(b.popoverContent)return"function"==typeof b.popoverContent?b.popoverContent.call(b):b.popoverContent;if(b.popoverSelector){var c=a(b.popoverSelector);return c.html()}return""},getPopoverPosition:function(b){var c=b.$el,d=c.get(0),e=d.getBoundingClientRect(),f=c.offset(),g=a.extend({},e,f);return g.top=g.top+g.height/2,g.left=g.left+g.width/2,g},getPopoverOffset:function(a,b,c,d){return"bottom"==a?{top:b.top,left:b.left-c/2}:"top"==a?{top:b.top-d,left:b.left-c/2}:"left"==a?{top:b.top-d/2,left:b.left-c}:"right"==a?{top:b.top-d/2,left:b.left}:"bottom-left"==a?{top:b.top,left:b.left-c}:"bottom-right"==a?{top:b.top,left:b.left}:"top-left"==a?{top:b.top-d,left:b.left-c}:"top-right"==a?{top:b.top-d,left:b.left}:{top:b.top-d,left:b.left-c/2}},applyPopoverPlacement:function(b,c,d){var e=b.$popover,f=(e[0].offsetWidth,e[0].offsetHeight,parseInt(e.css("margin-top"),10)),g=parseInt(e.css("margin-left"),10),h=parseInt(e.css("margin-bottom"),10),i=parseInt(e.css("margin-right"),10);isNaN(f)&&(f=0),isNaN(g)&&(g=0),isNaN(h)&&(h=0),isNaN(i)&&(i=0),c.top+=f-h,c.left+=g-i,a.offset.setOffset(e[0],a.extend({using:function(a){e.css({top:Math.round(a.top),left:Math.round(a.left)})}},c),0);for(var j=["top","left","bottom","right","top-left","top-right","bottom-left","bottom-right"],k=j.length;k--;)if(j[k]==d){j.splice(k,1);break}for(var k=j.length;k--;)e.removeClass("imgl-popover-"+j[k]);e.addClass("imgl-popover-"+d)},hidePopover:function(b){b.$popover&&(b.$popover.hasClass("imgl-active")||b.$popover.hasClass(this.config.popoverShowClass))&&(b.$popover.removeClass(this.config.popoverShowClass),b.$popover.css("z-index",""),b.$el.css("z-index",""),this.config.popoverHideClass?(b.$popover.addClass(this.config.popoverHideClass),b.$popover.one(this.util().animationEvent(),a.proxy(function(b){var c=a(b.target);c.hasClass(this.config.popoverShowClass)||(c.removeClass(this.config.popoverHideClass),this.retachPopover(c))},this))):this.retachPopover(b.$popover))},retachPopover:function(a){a.removeClass("imgl-active"),a.detach(),a.get(0).offsetHeight,a.appendTo(this.controls.$view),0==this.controls.$view.find(".imgl-popover.imgl-active").length&&(this.controls.$view.find(".imgl-hotspot, .imgl-popover").css("z-index",""),this.zindex=4)},liftupPopover:function(a){(this.hotSpots.length>1||a.popoverShow)&&(this.config.hotSpotBelowPopover?(a.$el.css("z-index",this.zindex+1),a.$popover.css("z-index",this.zindex+2)):(a.$el.css("z-index",this.zindex+2),a.$popover.css("z-index",this.zindex+1)),this.zindex=this.zindex+2)},updateLayout:function(){this.updateHotSpots(),this.updatePopovers()},onAnimationStart:function(a){this.updateLayout()},onLoad:function(b){this.updateLayout(),setTimeout(a.proxy(this.showPopovers,this),400)},onResize:function(a){this.updateLayout()},onHotSpotClick:function(a,b){a.$popover&&a.$popover.hasClass("imgl-active")||b.stopImmediatePropagation(),this.showPopover(a)},onHotSpotEnter:function(a,b){this.showPopover(a)},onHotSpotTouchStart:function(a,b){this.showPopover(a)},onHotSpotTouchEnd:function(b,c){a(c.target).is("a")&&(c.preventDefault(),c.target.click())},onHotSpotLeave:function(b,c){if(b.$popover){var d=c.toElement||c.relatedTarget;0!==b.$popover.has(d).length||b.$popover.is(d)||b.$el.is(d)?b.$popover.one("mouseleave.imgl",a.proxy(this.onHotSpotLeave,this,b)):this.hidePopover(b)}},onPopoverClick:function(a,b){a.$popover&&this.liftupPopover(a)},onPopoverHide:function(b,c){b.$popover&&(0===b.$popover.has(c.target).length||a(c.target).hasClass("imgl-close"))&&(a(c.target).hasClass("imgl-close")&&c.stopImmediatePropagation(),this.hidePopover(b))},onViewClick:function(a){if(this.hotSpotSetup){var b=this.controls.$view.offset(),c=a.pageX-b.left,d=a.pageY-b.top,e=this.controls.$view.get(0).getBoundingClientRect(),f=e.right-e.left,g=e.bottom-e.top,h=c/f,i=d/g;console.log("x:"+h+", y:"+i)}},onViewKeyDown:function(a){a.ctrlKey&&(this.controls.$view.focus(),this.hotSpotSetup=!0)},onViewKeyUp:function(a){this.hotSpotSetup=!1},destroy:function(){this.controls.$main&&(this.resetHotSpots(),this.resetHandlers(),this.resetDOM())},util:function(){return null!=this._util?this._util:this._util=new d}},a.fn.imagelinks=function(b,d){if("instance"==b){var f=a(this),g=f.data(e);return g?g:void console.error("Calling 'instance' method on not initialized instance is forbidden")}return this.each(function(){var d=a(this),f=d.data(e),g=a.isPlainObject(b)?b:{};if("destroy"==b)return f||console.error("Calling 'destroy' method on not initialized instance is forbidden"),d.removeData(e),void f.destroy();if("resize"==b)return f||console.error("Calling 'resize' method on not initialized instance is forbidden"),void this.updateLayout();if(f){var h=a.extend({},f.config,g);f.init(d,h)}else{var h=a.extend({},c.prototype.defaults,g);f=new c(d,h),d.data(e,f)}})}}(window.jQuery);